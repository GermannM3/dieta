# üîÑ –†–ê–ë–û–ß–ò–ô –ë–≠–ö–ê–ü –°–û–°–¢–û–Ø–ù–ò–Ø –ë–û–¢–ê

## üìÖ –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: 26.07.2025 13:14 MSK

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

### 1. **–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±–æ—Ç–∞**
- ‚úÖ –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å–æ–∑–¥–∞–Ω–∏–µ, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, –ø–æ–ª—É—á–µ–Ω–∏–µ)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –µ–¥—ã —Å —Ä–∞—Å—á–µ—Ç–æ–º –∫–∞–ª–æ—Ä–∏–π
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–∏–µ–º–æ–≤ –ø–∏—â–∏
- ‚úÖ –¢—Ä–µ–∫–µ—Ä –≤–æ–¥—ã
- ‚úÖ –¢—Ä–µ–∫–µ—Ä –∂–∏—Ä–æ–≤–æ–π –º–∞—Å—Å—ã
- ‚úÖ –ë–∞–ª–ª—ã –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- ‚úÖ –®–∞–±–ª–æ–Ω—ã –µ–¥—ã

### 2. **–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–ø–∏—Å–æ–∫ (—Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º)**
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫ –±–µ–∑ YooKassa
- ‚úÖ –ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–æ–∫ "–õ–∏—á–Ω—ã–π –¥–∏–µ—Ç–æ–ª–æ–≥"
- ‚úÖ –ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–æ–∫ "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–µ–Ω—é"
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–ø–∏—Å–æ–∫
- ‚úÖ –î–æ—Å—Ç—É–ø –∫ –ø—Ä–µ–º–∏—É–º —Ñ—É–Ω–∫—Ü–∏—è–º

### 3. **Debug-–ª–æ–≥–∏**
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–µ–π
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ YooKassa –Ω–∞—Å—Ç—Ä–æ–µ–∫
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø–æ–¥–ø–∏—Å–æ–∫

## üîß –¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

### YooKassa (live-–∫–ª—é—á–∏)
```
YOOKASSA_SHOP_ID=390540012
YOOKASSA_SECRET_KEY=live_4nHajHuzYGMrBPFLXQojoRW1_6ay2jy7SqSBUl16JOA
YOOKASSA_PAYMENT_TOKEN=390540012:LIVE:73839
```

### API –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```
API_BASE_URL=http://localhost:8000
FRONTEND_URL=http://5.129.198.80:3000
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
```
DATABASE_URL=postgresql+asyncpg://neondb_owner:npg_wNt53iaxXIBq@ep-lively-hall-aduj1169-pooler.c-2.us-east-1.aws.neon.tech/neondb?sslmode=require
```

## üö® –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

### 1. **YooKassa –∞–∫–∫–∞—É–Ω—Ç –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω**
- –û—à–∏–±–∫–∞ 401 –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º –¥–ª—è –æ–±—Ö–æ–¥–∞
- –ù—É–∂–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç –≤ YooKassa

### 2. **–û–±—Ä–∞–±–æ—Ç—á–∏–∫ "–ú–æ–∏ –ø–æ–¥–ø–∏—Å–∫–∏"**
- –ú–æ–∂–µ—Ç –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∏–∑-–∑–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤
- –î–æ–±–∞–≤–ª–µ–Ω debug-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

## üìÅ –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã:

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- `main.py` - –≥–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –±–æ—Ç–∞
- `components/handlers/user_handlers.py` - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `components/payment_system/payment_operations.py` - –ø–ª–∞—Ç–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
- `components/payment_system/payment_handlers.py` - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π
- `database/init_database.py` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- `.env` - –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `improved_api_server.py` - API —Å–µ—Ä–≤–µ—Ä
- `docker-compose.yml` - Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

## üîÑ –ö–∞–∫ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —ç—Ç–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:

### 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–æ—Ç–∞
```bash
sudo systemctl stop bot
```

### 2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
```bash
cd /opt/dieta
git pull origin main
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å .env
```bash
cat /opt/dieta/.env | grep YOOKASSA
```

### 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
```bash
sudo systemctl start bot
sudo systemctl status bot
```

### 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
```bash
sudo journalctl -u bot -f
```

## üéØ –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:

### –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–õ–∏—á–Ω—ã–π –¥–∏–µ—Ç–æ–ª–æ–≥":
```
‚úÖ –¢–µ—Å—Ç–æ–≤–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞!
–í–∞—à–∞ –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –ª–∏—á–Ω–æ–≥–æ –¥–∏–µ—Ç–æ–ª–æ–≥–∞ –∞–∫—Ç–∏–≤–Ω–∞ –Ω–∞ 7 –¥–Ω–µ–π.
–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞–¥–∞–≤–∞—Ç—å –ª—é–±—ã–µ –≤–æ–ø—Ä–æ—Å—ã –æ –ø–∏—Ç–∞–Ω–∏–∏!
```

### –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–µ–Ω—é":
```
‚úÖ –¢–µ—Å—Ç–æ–≤–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞!
–í–∞—à–∞ –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –º–µ–Ω—é –∞–∫—Ç–∏–≤–Ω–∞ –Ω–∞ 7 –¥–Ω–µ–π.
–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞–∫–∞–∑—ã–≤–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –º–µ–Ω—é!
```

### –í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
DEBUG: PaymentManager.create_payment called
DEBUG: Using temporary test mode - creating subscription without YooKassa
DEBUG: Creating test subscription for diet_consultant, amount: 200
DEBUG: Test subscription created and activated for user XXXXX
```

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1. **–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç YooKassa** - —Å–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π
2. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å "–ú–æ–∏ –ø–æ–¥–ø–∏—Å–∫–∏"** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å debug-–ª–æ–≥–∏
3. **–í–∫–ª—é—á–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏** - –ø–æ—Å–ª–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ YooKassa
4. **–£–±—Ä–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º** - –≤–µ—Ä–Ω—É—Ç—å –æ–±—ã—á–Ω—É—é —Ä–∞–±–æ—Ç—É —Å YooKassa

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:
- GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: https://github.com/GermannM3/dieta
- –ö–æ–º–º–∏—Ç: `1f073ce` - "–î–æ–±–∞–≤–ª–µ–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º –¥–ª—è –ø–ª–∞—Ç–µ–∂–µ–π –∏ debug-–ª–æ–≥–∏"
- –î–∞—Ç–∞: 26.07.2025 13:14 MSK

---
**‚ö†Ô∏è –í–ê–ñ–ù–û: –≠—Ç–æ—Ç –±—ç–∫–∞–ø —Å–æ–∑–¥–∞–Ω –≤ —Ä–∞–±–æ—á–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —Å —Ç–µ—Å—Ç–æ–≤—ã–º —Ä–µ–∂–∏–º–æ–º –ø–ª–∞—Ç–µ–∂–µ–π.**
**–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –Ω—É–∂–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å YooKassa –∏ —É–±—Ä–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º.** 