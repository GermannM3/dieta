#!/bin/bash

echo "üöÄ –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å Docker..."

# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
echo "üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã..."
docker-compose down

# –û—á–∏—â–∞–µ–º Docker (–¥–ª—è —Å—Ç–∞—Ä–æ–≥–æ Docker)
echo "üßπ –û—á–∏—â–∞–µ–º Docker..."
docker container prune -f
docker image prune -f
docker volume prune -f
docker network prune -f

# –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ–º –±–µ–∑ –∫—ç—à–∞
echo "üî® –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã..."
docker-compose build --no-cache

# –ó–∞–ø—É—Å–∫–∞–µ–º
echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã..."
docker-compose up -d

# –ñ–¥–µ–º –∑–∞–ø—É—Å–∫–∞
echo "‚è≥ –ñ–¥–µ–º –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤..."
sleep 30

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å
echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å..."
docker-compose ps

# –ü—Ä–æ–≤–µ—Ä—è–µ–º API
echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º API..."
curl -f http://5.129.198.80:8000/health || echo "‚ùå API –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ–º–µ–Ω—ã
echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ–º–µ–Ω—ã..."
curl -f -k https://—Ç–≤–æ–π-–∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä.—Ä—Ñ || echo "‚ùå –î–æ–º–µ–Ω —Ç–≤–æ–π-–∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä.—Ä—Ñ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç"
curl -f -k https://tvoi-kalkulyator.ru || echo "‚ùå –î–æ–º–µ–Ω tvoi-kalkulyator.ru –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç"

echo "‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!" 