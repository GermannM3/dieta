# üìã –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö –ø—Ä–æ–±–ª–µ–º —Å –±–æ—Ç–æ–º

## üö® –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø—Ä–æ—Ñ–∏–ª–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–°–∏–º–ø—Ç–æ–º**: –ë–æ—Ç –Ω–µ –≤—ã—Ç–∞—Å–∫–∏–≤–∞–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å –∏–∑ –ë–î, –ø—ã—Ç–∞–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π
- **–ü—Ä–∏—á–∏–Ω–∞**: –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å—é –æ—Ç API —Å–µ—Ä–≤–µ—Ä–∞
- **–†–µ—à–µ–Ω–∏–µ**: –£–ø—Ä–æ—â–µ–Ω–∞ –ª–æ–≥–∏–∫–∞, —É–±—Ä–∞–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç API

### 2. –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–ª–∞—Ç–µ–∂–∞–º–∏ YooKassa
- **–°–∏–º–ø—Ç–æ–º**: –û—à–∏–±–∫–∏ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–∞—Ö –æ–ø–ª–∞—Ç—ã "Payment providers for –¢–≤–æ–π –¥–∏–µ—Ç–æ–ª–æ–≥"
- **–ü—Ä–∏—á–∏–Ω–∞**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è —Å—Ç–∞—Ä—ã–π —Ç–æ–∫–µ–Ω YooKassa –≤–º–µ—Å—Ç–æ –Ω–æ–≤–æ–≥–æ
- **–†–µ—à–µ–Ω–∏–µ**: –û–±–Ω–æ–≤–ª–µ–Ω —Ç–æ–∫–µ–Ω –Ω–∞ –Ω–æ–≤—ã–π –∏–∑ BotFather

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ YooKassa

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- `components/payment_system/payment_handlers.py`
- `components/payment_system/payment_operations.py`
- `server.env`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```diff
- YOOKASSA_PAYMENT_TOKEN = '381764678:TEST:132209'
+ YOOKASSA_PAYMENT_TOKEN = '390540012:LIVE:73839'

- YOOKASSA_SHOP_ID = '1097156'
+ YOOKASSA_SHOP_ID = '390540012'

- Configuration.account_id = "1097156"
+ Configuration.account_id = "390540012"
```

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è

**–§–∞–π–ª –∏–∑–º–µ–Ω–µ–Ω:**
- `components/handlers/user_handlers.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```diff
- # –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–∞–∑–µ —á–µ—Ä–µ–∑ API –¥–ª—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- try:
-     r = requests.get(f'{API_URL}/api/profile?tg_id={message.from_user.id}')
-     if r.status_code == 200:
-         profile = r.json().get('profile')
-         if not profile.get('name'):
-             profile_data = {...}
-             requests.post(f'{API_URL}/api/profile', json=profile_data)
- except:
-     pass

+ # –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç API
+ try:
+     profile = await get_user_profile(message.from_user.id)
+     if not profile or not profile.get('name'):
+         # –ü—Ä–æ—Ñ–∏–ª—å –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω, –Ω–æ –Ω–µ —Å–æ–∑–¥–∞–µ–º –µ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
+         pass
+ except Exception as e:
+     print(f"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è: {e}")
```

**–î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç:**
```python
from database.crud import get_user_profile
```

### 3. –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

**–ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:**
- `quick_fix_bot_issues.py` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- `QUICK_BOT_FIX.md` - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –±—ã—Å—Ç—Ä–æ–º—É –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

## üîß –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é

### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å:

```bash
# 1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh root@5.129.198.80
cd /opt/dieta
source venv/bin/activate

# 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞
git pull origin main

# 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ .env —Ñ–∞–π–ª–∞
nano .env
# –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ YooKassa

# 4. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Redis
sudo snap start redis
# –∏–ª–∏
sudo docker run -d --name redis -p 6379:6379 redis:alpine

# 5. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
sudo systemctl stop bot
sudo pkill -f "python.*main"
sudo systemctl start bot

# 6. –ü—Ä–æ–≤–µ—Ä–∫–∞
sudo systemctl status bot
sudo journalctl -u bot -f
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
```bash
python quick_fix_bot_issues.py
```

## üéØ –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

### ‚úÖ –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ë–æ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ø—Ä–æ—Ñ–∏–ª–µ–º
- –ù–µ—Ç –ø–æ–ø—ã—Ç–æ–∫ —Å–æ–∑–¥–∞–Ω–∏—è –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π
- –ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –ë–î

### ‚úÖ –ü–ª–∞—Ç–µ–∂–∏ YooKassa
- –ü–ª–∞—Ç–µ–∂–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Å –Ω–æ–≤—ã–º —Ç–æ–∫–µ–Ω–æ–º
- –ù–µ—Ç –æ—à–∏–±–æ–∫ "Payment providers"
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å YooKassa

### ‚úÖ –û–±—â–∞—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å
- Redis —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ snap –∏–ª–∏ Docker
- –ë–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- –û–¥–∏–Ω –ø—Ä–æ—Ü–µ—Å—Å –±–æ—Ç–∞

## üìä –°—Ç–∞—Ç—É—Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|-----------|--------|------------|
| –¢–æ–∫–µ–Ω YooKassa | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω | –û–±–Ω–æ–≤–ª–µ–Ω –Ω–∞ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω |
| –õ–æ–≥–∏–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ | –£–±—Ä–∞–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç API |
| Redis | ‚úÖ –ì–æ—Ç–æ–≤ | –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è |
| –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ | ‚úÖ –°–æ–∑–¥–∞–Ω—ã | –ü–æ–¥—Ä–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ |
| –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è | ‚úÖ –°–æ–∑–¥–∞–Ω–∞ | –°–∫—Ä–∏–ø—Ç quick_fix_bot_issues.py |

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ** –ø–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
2. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–æ—Ç–∞** –≤ Telegram
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–ª–∞—Ç–µ–∂–∏** —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É `/diet_consultant`
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ª–æ–≥–∏** –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –æ—à–∏–±–æ–∫

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: `sudo journalctl -u bot -f`
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: `python quick_fix_bot_issues.py`
3. –°–ª–µ–¥–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤ `QUICK_BOT_FIX.md`

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: 25.07.2025  
**–°—Ç–∞—Ç—É—Å**: –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –í—ã—Å–æ–∫–∏–π 