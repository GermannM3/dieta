# üîß –ë—ã—Å—Ç—Ä–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ debug-—Ñ–∏–∫—Å–æ–≤

## üìã –ß—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–æ:

### 1. **Debug-–ª–æ–≥–∏ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ "–ú–æ–∏ –ø–æ–¥–ø–∏—Å–∫–∏"**
- –î–æ–±–∞–≤–ª–µ–Ω—ã print-—Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–æ–∫ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

### 2. **Debug-–ª–æ–≥–∏ –≤ PaymentManager.create_payment**
- –í—ã–≤–æ–¥ –≤—Å–µ—Ö YooKassa –Ω–∞—Å—Ç—Ä–æ–µ–∫
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞
- –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

### 3. **–û–±–Ω–æ–≤–ª–µ–Ω—ã YooKassa –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**
- YOOKASSA_SHOP_ID=390540012
- YOOKASSA_SECRET_KEY=live_4nHajHuzYGMrBPFLXQojoRW1_6ay2jy7SqSBUl16JOA
- YOOKASSA_PAYMENT_TOKEN=390540012:LIVE:73839

## üöÄ –ë—ã—Å—Ç—Ä–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

### 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–æ—Ç–∞
```bash
sudo systemctl stop bot
```

### 2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
```bash
cd /opt/dieta
git pull origin main
```

### 3. –û–±–Ω–æ–≤–∏—Ç—å .env –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
```bash
sudo nano /opt/dieta/.env
```

–ó–∞–º–µ–Ω–∏—Ç—å YooKassa –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞:
```
YOOKASSA_SHOP_ID=390540012
YOOKASSA_SECRET_KEY=live_4nHajHuzYGMrBPFLXQojoRW1_6ay2jy7SqSBUl16JOA
YOOKASSA_PAYMENT_TOKEN=390540012:LIVE:73839
```

### 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
```bash
sudo systemctl start bot
sudo systemctl status bot
```

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –±–æ—Ç–∞
```bash
sudo journalctl -u bot -f
```

### 2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å "–ú–æ–∏ –ø–æ–¥–ø–∏—Å–∫–∏"
- –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "üí≥ –ú–æ–∏ –ø–æ–¥–ø–∏—Å–∫–∏" –≤ –±–æ—Ç–µ
- –í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è debug-—Å–æ–æ–±—â–µ–Ω–∏—è:
  ```
  DEBUG: my_subscriptions_handler called
  DEBUG: Checking subscriptions for user XXXXX
  DEBUG: diet_subscription found: False
  DEBUG: menu_subscription found: False
  DEBUG: Sending response: üìã –í–∞—à–∏ –ø–æ–¥–ø–∏—Å–∫–∏:...
  ```

### 3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
- –ù–∞–∂–∞—Ç—å "–õ–∏—á–Ω—ã–π –¥–∏–µ—Ç–æ–ª–æ–≥" –∏–ª–∏ "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–µ–Ω—é"
- –í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è debug-—Å–æ–æ–±—â–µ–Ω–∏—è:
  ```
  DEBUG: PaymentManager.create_payment called
  DEBUG: YOOKASSA_SHOP_ID = 390540012
  DEBUG: YOOKASSA_SECRET_KEY = live_4nHajHuzYGMrBPFLXQojoRW1_6ay2jy7SqSBUl16JOA
  DEBUG: YOOKASSA_PAYMENT_TOKEN = 390540012:LIVE:73839
  DEBUG: Configuration.account_id = 390540012
  DEBUG: Configuration.secret_key = live_4nHajHuzYGMrBPFLXQojoRW1_6ay2jy7SqSBUl16JOA
  DEBUG: Creating payment for diet_consultant, amount: 200
  ```

## üéØ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

### ‚úÖ "–ú–æ–∏ –ø–æ–¥–ø–∏—Å–∫–∏" –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å:
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–¥–ø–∏—Å–∫–∞—Ö
- –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
- –í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å debug-—Å–æ–æ–±—â–µ–Ω–∏—è

### ‚úÖ YooKassa –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å:
- –°–æ–∑–¥–∞–≤–∞—Ç—å –ø–ª–∞—Ç–µ–∂–∏ –±–µ–∑ –æ—à–∏–±–∫–∏ 401
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ live-–∫–ª—é—á–∏
- –í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å debug-—Å–æ–æ–±—â–µ–Ω–∏—è –æ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–∞

## üö® –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –æ—Å—Ç–∞—é—Ç—Å—è:

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å .env –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```bash
cat /opt/dieta/.env | grep YOOKASSA
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```bash
sudo systemctl show bot | grep Environment
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ API:
```bash
sudo journalctl -u api -f
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤:
```bash
sudo systemctl status bot api
```

## üìû –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å:
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ª–æ–≥–∏ —Å debug-—Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
- –£–∫–∞–∑–∞—Ç—å –∫–∞–∫–∏–µ –∏–º–µ–Ω–Ω–æ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç
- –ü—Ä–∏–ª–æ–∂–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –æ—à–∏–±–æ–∫ 