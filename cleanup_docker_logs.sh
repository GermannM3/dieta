#!/bin/bash

echo "üßπ –û–ß–ò–°–¢–ö–ê DOCKER –õ–û–ì–û–í"
echo "=========================="
echo ""

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ sudo
if [ "$EUID" -ne 0 ]; then 
    echo "‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç —Å sudo:"
    echo "   sudo bash cleanup_docker_logs.sh"
    exit 1
fi

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π —Ä–∞–∑–º–µ—Ä –ª–æ–≥–æ–≤
echo "üìä –¢–µ–∫—É—â–∏–π —Ä–∞–∑–º–µ—Ä –ª–æ–≥–æ–≤ Docker:"
du -sh /var/lib/docker/containers/*/
echo ""

# –ü–æ–ª—É—á–∞–µ–º –æ–±—â–∏–π —Ä–∞–∑–º–µ—Ä
TOTAL_SIZE=$(du -sh /var/lib/docker/containers/ | cut -f1)
echo "üì¶ –û–±—â–∏–π —Ä–∞–∑–º–µ—Ä: $TOTAL_SIZE"
echo ""

# –°–ø—Ä–∞—à–∏–≤–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
read -p "‚ö†Ô∏è  –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤? (yes/no): " -r
echo ""
if [[ ! $REPLY =~ ^[Yy]es$ ]]; then
    echo "‚ùå –û—Ç–º–µ–Ω–µ–Ω–æ"
    exit 1
fi

# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
echo "‚è∏Ô∏è  –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã..."
docker-compose stop

# –û—á–∏—â–∞–µ–º –ª–æ–≥–∏
echo "üóëÔ∏è  –û—á–∏—â–∞–µ–º –ª–æ–≥–∏..."
truncate -s 0 /var/lib/docker/containers/*/*-json.log

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä
echo ""
echo "‚úÖ –õ–æ–≥–∏ –æ—á–∏—â–µ–Ω—ã!"
echo "üìä –ù–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä:"
du -sh /var/lib/docker/containers/*/
echo ""

NEW_SIZE=$(du -sh /var/lib/docker/containers/ | cut -f1)
echo "üì¶ –û–±—â–∏–π —Ä–∞–∑–º–µ—Ä: $NEW_SIZE"
echo ""

# –ó–∞–ø—É—Å–∫–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –æ–±—Ä–∞—Ç–Ω–æ
echo "‚ñ∂Ô∏è  –ó–∞–ø—É—Å–∫–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å –Ω–æ–≤—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è..."
docker-compose up -d

echo ""
echo "‚úÖ –ì–û–¢–û–í–û!"
echo ""
echo "üìù –¢–µ–ø–µ—Ä—å –ª–æ–≥–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã:"
echo "   - Bot/API: –º–∞–∫—Å 10MB x 3 —Ñ–∞–π–ª–∞ = 30MB"
echo "   - Frontend/Nginx: –º–∞–∫—Å 5MB x 2 —Ñ–∞–π–ª–∞ = 10MB"
echo ""
echo "üìä –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä –ª–æ–≥–æ–≤ –º–æ–∂–Ω–æ –∫–æ–º–∞–Ω–¥–æ–π:"
echo "   sudo du -sh /var/lib/docker/containers/*/"

