#!/bin/bash

echo "ü§ñ –ó–∞–ø—É—Å–∫ –¥–∏–µ—Ç-–±–æ—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ"
echo "================================"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ venv –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω
if [[ "$VIRTUAL_ENV" == "" ]]; then
    echo "‚ùå –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ!"
    echo "–ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ venv: source venv/bin/activate"
    exit 1
fi

echo "‚úÖ –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ: $VIRTUAL_ENV"

# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞—Ä—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤..."
pkill -f "python.*main.py" || true
pkill -f "python.*improved_api_server.py" || true
pkill -f "npm.*start" || true
pkill -f "nginx" || true

sleep 2

# –ó–∞–ø—É—Å–∫–∞–µ–º –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
echo "üöÄ –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤..."
python start_all_services.py

echo "‚úÖ –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã!"
echo "üì± –ë–æ—Ç: @tvoy_diet_bot"
echo "üåê –°–∞–π—Ç: http://5.129.198.80"
echo "üìä API: http://5.129.198.80:8000/docs" 